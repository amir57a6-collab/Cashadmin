<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Manage Users</title>
    <style>@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');body{font-family:'Inter',sans-serif;background-color:#111827;color:#d1d5db;margin:0}.loading-spinner{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);border:4px solid #374151;border-top:4px solid #10b981;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite}.content-wrapper{display:none}.container{display:flex;min-height:100vh}.sidebar{width:250px;background-color:#1f2937;padding:1.5rem}.sidebar-header{font-size:1.5rem;font-weight:700;color:#fff;margin-bottom:2rem}.sidebar-nav a{display:block;color:#9ca3af;text-decoration:none;padding:.75rem 1rem;border-radius:.5rem;margin-bottom:.5rem;font-weight:500}.sidebar-nav a.active{background-color:#10b981;color:#fff}.main-content{flex:1;padding:2.5rem;overflow-y:auto}.main-header h1{font-size:2rem;font-weight:700;color:#fff;margin:0}.main-header p{color:#9ca3af;margin-top:.5rem}.search-bar{margin:2rem 0}.search-bar input{width:100%;max-width:400px;padding:.75rem 1rem;background-color:#1f2937;border:1px solid #374151;border-radius:.5rem;color:#d1d5db}.data-table{width:100%;border-collapse:collapse;background-color:#1f2937;border-radius:.75rem;overflow:hidden}.data-table td,.data-table th{padding:1rem 1.5rem;text-align:left}.data-table thead{background-color:#374151}.data-table th{font-weight:600;color:#fff}.data-table tbody tr{border-bottom:1px solid #374151}.data-table tbody tr:last-child{border-bottom:none}.action-btn{background-color:#374151;color:#fff;border:none;padding:.5rem 1rem;border-radius:.5rem;cursor:pointer;text-decoration:none} @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}</style>
</head>
<body>
    <div class="loading-spinner" id="loader"></div>
    <div class="content-wrapper" id="content">
        <div class="container">
            <aside class="sidebar">
                <h1 class="sidebar-header">Task Manager</h1>
                <nav class="sidebar-nav">
                    <a href="dashboard.html">Dashboard</a><a href="users.html" class="active">Users</a><a href="manage-tasks.html">Create Task</a><a href="task-list.html">Task List</a><a href="withdrawals.html">Withdrawals</a><a href="settings.html">Settings</a>
                </nav>
            </aside>
            <main class="main-content">
                <header class="main-header">
                    <h1>Users</h1><p>Manage user accounts and details.</p>
                </header>
                <div class="search-bar"><input type="text" id="user-search" placeholder="Search users by username or email"></div>
                <table class="data-table">
                    <thead><tr><th>Username</th><th>Email</th><th>Balance</th><th>Referral Code</th></tr></thead>
                    <tbody id="users-table-body"></tbody>
                </table>
            </main>
        </div>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, collection, getDocs, orderBy, query } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";
        const firebaseConfig = { apiKey: "AIzaSyBNy8sZGAKh3Ika7O7F-NLZZZWAU-j2B0A", authDomain: "cashcoinser.firebaseapp.com", projectId: "cashcoinser", storageBucket: "cashcoinser.appspot.com", messagingSenderId: "179560740788", appId: "1:179560740788:web:4d6f5678e80f86899364e1" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const ADMIN_EMAIL = "amir57a6@gmail.com";
        const loader = document.getElementById('loader');
        const content = document.getElementById('content');
        onAuthStateChanged(auth, user => {
            if (user && user.email === ADMIN_EMAIL) { loadUsers(); loader.style.display = 'none'; content.style.display = 'block'; } else { window.location.href = 'index.html'; }
        });
        const usersTableBody = document.getElementById('users-table-body');
        let allUsers = [];
        async function renderUsers(users) {
            usersTableBody.innerHTML = '';
            if (users.length === 0) { usersTableBody.innerHTML = `<tr><td colspan="4" style="text-align:center;padding:2rem;">No users found.</td></tr>`; return; }
            users.forEach(user => {
                const row = `<tr><td>${user.name}</td><td>${user.email}</td><td>$${user.balance.toFixed(2)}</td><td>${user.referralCode}</td></tr>`;
                usersTableBody.innerHTML += row;
            });
        }
        async function loadUsers() {
            const q = query(collection(db, "users"), orderBy("createdAt", "desc"));
            const querySnapshot = await getDocs(q);
            allUsers = querySnapshot.docs.map(doc => doc.data());
            renderUsers(allUsers);
        }
        document.getElementById('user-search').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredUsers = allUsers.filter(user => user.name.toLowerCase().includes(searchTerm) || user.email.toLowerCase().includes(searchTerm));
            renderUsers(filteredUsers);
        });
    </script>
</body>
</html>